-- WYMAGANE: Enable "Run Context Menu" w Executorze
local Player = game:GetService("Players").LocalPlayer
local Character = Player.Character
local Humanoid = Character:WaitForChild("Humanoid")
local Root = Character:WaitForChild("HumanoidRootPart")

-- Konfiguracja (dostosuj wartości!)
local TELEPORT_OFFSET = Vector3.new(0, 5, 0)
local ORE_NAMES = {"Coal", "Iron", "Gold", "Diamond"} -- UPEWNIJ SIĘ ŻE TO SĄ PRAWDZIWE NAZWY
local TRUCK_NAME = "MiningTruck" -- Nazwa modelu ciężarówki
local UNLOAD_PART_NAME = "UnloadZone" -- Nazwa strefy rozładunku

-- Lokalizacja elementów
local MiningRemote = game:GetService("ReplicatedStorage"):WaitForChild("MineOre")
local Truck = workspace:FindFirstChild(TRUCK_NAME)
local UnloadZone = workspace:FindFirstChild(UNLOAD_PART_NAME)

local function AntiKick()
    pcall(function()
        game:GetService("Players").LocalPlayer.Idled:Connect(function()
            game:GetService("VirtualUser"):ClickButton2(Vector2.new())
        end)
    end)
end

local function FindClosestOre()
    local closest = nil
    local maxDistance = math.huge
    
    for _, obj in pairs(workspace:GetDescendants()) do
        if table.find(ORE_NAMES, obj.Name) and obj:FindFirstChild("Position") then
            local distance = (Root.Position - obj.Position).Magnitude
            if distance < maxDistance then
                closest = obj
                maxDistance = distance
            end
        end
    end
    return closest
end

local function SmartTeleport(target)
    if not target then return end
    local tween = game:GetService("TweenService"):Create(
        Root,
        TweenInfo.new(2, Enum.EasingStyle.Linear),
        {CFrame = target.CFrame * CFrame.new(TELEPORT_OFFSET)}
    )
    tween:Play()
    tween.Completed:Wait()
end

local function AutoMine(ore)
    repeat
        MiningRemote:FireServer(ore)
        task.wait(0.3)
    until not ore or not ore.Parent
end

local function LoadTruck()
    if Truck and Truck:FindFirstChild("CargoBay") then
        firetouchinterest(Root, Truck.CargoBay, 0)
        task.wait()
        firetouchinterest(Root, Truck.CargoBay, 1)
    end
end

local function AutoUnload()
    if UnloadZone then
        repeat
            firetouchinterest(Root, UnloadZone, 0)
            task.wait()
            firetouchinterest(Root, UnloadZone, 1)
            task.wait(1)
        until Truck.CargoBay:GetAttribute("Quantity") == 0
    end
end

AntiKick()

while task.wait() do
    -- Faza wydobycia
    local ore = FindClosestOre()
    if ore then
        SmartTeleport(ore)
        AutoMine(ore)
    end

    -- Faza załadunku
    if Truck and Truck:GetAttribute("CargoSpace") > 0 then
        SmartTeleport(Truck.PrimaryPart)
        LoadTruck()
    end

    -- Faza rozładunku
    if UnloadZone and Truck:GetAttribute("CargoSpace") <= 0 then
        SmartTeleport(UnloadZone)
        AutoUnload()
    end
end
